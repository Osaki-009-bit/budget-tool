<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>轻记账｜客观统计</title>

<style>
body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;margin:0;background:#f6f7fb;}
.wrap{max-width:980px;margin:0 auto;padding:16px;}
.layout{display:flex;gap:12px;align-items:flex-start;}
.sidebar{
  width:170px;flex:0 0 170px;
  position:sticky;top:12px;
  background:#fff;border-radius:16px;padding:12px;
  box-shadow:0 6px 18px rgba(0,0,0,.06);
}
.month-nav{display:flex;flex-direction:column;gap:6px;}
.month-item{
  border:1px solid #e6e6e6;background:#fff;border-radius:12px;
  padding:10px;cursor:pointer;
  display:flex;justify-content:space-between;
}
.month-item.active{background:#111;color:#fff;}
.main{flex:1;min-width:0;}
.card{background:#fff;border-radius:16px;padding:16px;box-shadow:0 6px 18px rgba(0,0,0,.06);}
h1{font-size:18px;margin:0 0 6px;}
.sub{color:#666;font-size:13px;margin:0 0 12px;}
label{display:block;font-size:14px;margin-top:12px;}
input{width:100%;padding:12px;font-size:16px;border:1px solid #ddd;border-radius:12px;}
.btn{margin-top:10px;padding:10px;border-radius:12px;border:0;cursor:pointer;}
.btn-primary{background:#111;color:#fff;width:100%;}

/* ===== 月历样式（按你要求） ===== */
#monthCalendar{
  margin-top:8px;
  display:grid;
  grid-template-columns:repeat(7,1fr);
  gap:6px;
}
.day-cell{
  padding:8px 0;
  text-align:center;
  border-radius:10px;
  font-size:13px;
  cursor:pointer;
  border:1px solid #ddd;
}

/* 今天 */
.day-today{
  background:#1976d2;
  color:#fff;
  font-weight:700;
}

/* 修改过 */
.day-edited{
  background:#fdecea;
  color:#c62828;
  font-weight:700;
}

/* 有记录未修改 */
.day-recorded{
  background:#e8f5e9;
  color:#2e7d32;
  font-weight:700;
}

/* 未记录 */
.day-empty{
  background:#ffffff;
  color:#333;
}
</style>
</head>

<body>
<div class="wrap">
  <div class="layout">

    <aside class="sidebar">
      <div class="sub">月份</div>
      <div class="month-nav" id="monthNav"></div>
    </aside>

    <main class="main">
      <div class="card">
        <h1>轻记账（客观统计）</h1>
        <p class="sub" id="dateLine">月份：—</p>

        <label>编辑日期（回改某一天）</label>
        <input id="datePicker" type="date" />

        <label>本月日历</label>
        <div id="monthCalendar"></div>

        <label>今日消费总数（CAD）</label>
        <input id="dayInput" type="number" placeholder="例如 35" />

        <button class="btn btn-primary" id="recordBtn">保存这天</button>
      </div>
    </main>

  </div>
</div>

<script>
/* ===== 工具 ===== */
const pad2=n=>String(n).padStart(2,'0');
const now=new Date();
const todayYmd=`${now.getFullYear()}-${pad2(now.getMonth()+1)}-${pad2(now.getDate())}`;
const currentYm=todayYmd.slice(0,7);

/* ===== 本地存储 ===== */
const KEY='budgetTool:v3';
const all=JSON.parse(localStorage.getItem(KEY)||'{}');
all.months=all.months||{};
function ensureMonth(ym){
  all.months[ym]=all.months[ym]||{days:{}};
  return all.months[ym];
}

/* ===== 状态 ===== */
let activeYm=currentYm;
let editYmd=todayYmd;
let monthData=ensureMonth(activeYm);

/* ===== DOM ===== */
const monthNav=document.getElementById('monthNav');
const datePicker=document.getElementById('datePicker');
const dayInput=document.getElementById('dayInput');

/* ===== 月历渲染（核心规则） ===== */
function renderMonthCalendar(){
  const cal=document.getElementById('monthCalendar');
  const days=new Date(activeYm.split('-')[0],activeYm.split('-')[1],0).getDate();
  const firstDay=new Date(activeYm+'-01').getDay();
  let html='';

  for(let i=0;i<firstDay;i++) html+='<div></div>';

  for(let d=1;d<=days;d++){
    const ymd=`${activeYm}-${pad2(d)}`;
    const rec=monthData.days[ymd]||{};
    let cls='day-empty';

    if(ymd===todayYmd){
      cls='day-today';
    }else if(rec.edited){
      cls='day-edited';
    }else if(typeof rec.total==='number'){
      cls='day-recorded';
    }

    html+=`<div class="day-cell ${cls}" data-d="${ymd}">${d}</div>`;
  }

  cal.innerHTML=html;

  cal.querySelectorAll('.day-cell').forEach(el=>{
    el.onclick=()=>{
      const d=el.dataset.d;
      if(!d || d>todayYmd) return;
      editYmd=d;
      datePicker.value=d;
      dayInput.value=monthData.days[d]?.total??'';
      renderMonthCalendar();
    };
  });
}

/* ===== 月份侧栏 ===== */
function renderMonthNav(){
  const months=Object.keys(all.months);
  if(!months.includes(currentYm)) months.push(currentYm);
  months.sort().reverse();
  monthNav.innerHTML=months.map(m=>{
    return `<div class="month-item ${m===activeYm?'active':''}" data-ym="${m}">${m}</div>`;
  }).join('');
  monthNav.querySelectorAll('.month-item').forEach(el=>{
    el.onclick=()=>{
      activeYm=el.dataset.ym;
      monthData=ensureMonth(activeYm);
      editYmd=(activeYm===currentYm)?todayYmd:`${activeYm}-01`;
      datePicker.value=editYmd;
      dayInput.value=monthData.days[editYmd]?.total??'';
      renderMonthNav();
      renderMonthCalendar();
    };
  });
}

/* ===== 保存 ===== */
document.getElementById('recordBtn').onclick=()=>{
  const v=Number(dayInput.value);
  const prev=monthData.days[editYmd];
  monthData.days[editYmd]={
    total:isNaN(v)?0:v,
    edited:!!prev
  };
  localStorage.setItem(KEY,JSON.stringify(all));
  renderMonthCalendar();
};

/* ===== 初始化 ===== */
datePicker.value=todayYmd;
renderMonthNav();
renderMonthCalendar();
</script>
</body>
</html>
